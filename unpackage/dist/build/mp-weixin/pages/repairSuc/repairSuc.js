(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/repairSuc/repairSuc"],{"0953":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("2f62"),i=s(o("45aa")),a=s(o("da85")),r=s(o("fbf6"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return l(e)||d(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function d(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function l(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){f(e,t,o[t])})}return e}function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var m=e.getRecorderManager(),p=e.createInnerAudioContext(),g="",_=getApp(),v={data:function(){return{id:"",imgArr:[],shoeboxImgArr:[],shoeboxImgResArr:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[],items:[{value:"is_xi",name:"清洗",checked:!1},{value:"is_xiu",name:"修复",checked:!1}]}},onLoad:function(){var e=this;(0,a.default)("/api/auth/getQiniuToken","POST",{}).then(function(t){e.qiniuToken=t.data}),(0,a.default)("/api/auth/getOrder","POST",{bar_id:this.shapecode}).then(function(t){t.data.length&&(e.shoeboxImgArr=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.shoeboxImgResArr=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.sound=t.data[0].sound,e.upShapeCode(t.data[0].bar_id),e.upJSName(t.data[0].username),e.items.forEach(function(e){"is_xi"===e.value&&1===t.data[0].is_xi?e.checked=!0:"is_xiu"===e.value&&1===t.data[0].is_xiu?e.checked=!0:e.checked=!1}),console.log(t))})},computed:h({},(0,n.mapState)(["jsName","shapecode","jsId"])),methods:h({},(0,n.mapMutations)(["upShapeCode","upJSName"]),{checkboxChange:function(e){for(var t=this.items,o=e.detail.value,n=0,i=t.length;n<i;++n){var a=t[n];o.includes(a.value)?this.$set(a,"checked",!0):this.$set(a,"checked",!1)}console.log(this.items)},isPlayImg:function(e){var t=e?"gif":"png",o="../../static/images/play_bg.",n=o+t;return n},Exhibition:function(e){return/static\.tosneaker\.com/gi.test(e)||/tmp/gi.test(e)?e:r.default.qiniuImgUrl+e},add_shoeboxImg:function(){var t=this,o=this.shoeboxImgArr;console.log(o),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.shoeboxImgArr=o.concat(e.tempFilePaths)}})},add_img:function(){var t=this,o=t.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.imgArr=o.concat(e.tempFilePaths)}})},deteleImg:function(e){var t=e.currentTarget.dataset.index,o=this.imgArr;o.splice(t,1),this.imgArr=o},add_remarks:function(e){var t=e.detail.value;this.remarks=t},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};m.start(e),m.onStart(function(){console.log("recorder start")}),m.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;m.stop(),m.onStop(function(t){console.log(t),e.time=Math.round(t.duration/1e3),e.is_recode=!1,e.voice=t.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",t.tempFilePath)})},playRecode:function(){var e=this,t=this,o=this.time;p.src=t.voice,p.play();var n=0;this.isplay=!0,g=setInterval(function(){if(n++,console.log(o),n>o)clearInterval(g),p.stop(),t.isplay=!1;else{var i=parseInt(n/60)+":"+parseInt(60*(parseFloat(n/60)-parseInt(n/60)));e.result_time=i}},1e3)},stop_play:function(){clearInterval(g),p.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,t){var o=this,n=[],a=[];return e.forEach(function(e){/static\.tosneaker\.com/gi.test(e)||/uploads/gi.test(e)||a.push(e)}),0===a.length?Promise.resolve(e):new Promise(function(e,r){a.forEach(function(s){var c=s.substr(30,50);i.default.upload(s,function(t){n.push(t.imageURL),o.resultImgArr=n,n.length==a.length&&e(n)},function(e){r(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:_.globalData.qiniuImgUrl,key:"uploads/wash/"+c,uptoken:t})})})},upRecord:function(e,t){return new Promise(function(o,n){var a=e.substr(30,50);i.default.upload(e,function(e){o(e)},function(e){n(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:_.globalData.qiniuImgUrl,key:"uploads/record/"+a,uptoken:t})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){var t=this;if(e.showLoading({mask:!0,title:"加载中..."}),0==this.shoeboxImgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张修复完成图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var o=this,n="",i={},r=0;r<this.items.length;r++)this.items[r].checked?i[[this.items[r].value]]=1:i[[this.items[r].value]]=0;""!==o.voice?o.upRecord(o.voice,o.qiniuToken).then(function(r){n=r.imageURL,console.log(n),o.upImgs(t.shoeboxImgArr,o.qiniuToken).then(function(r){var s;r=c(new Set((s=r).concat.apply(s,c(t.shoeboxImgResArr)))),console.log(r),(0,a.default)("/api/auth/setDone","POST",{wash_id:JSON.parse(e.getStorageSync("user"))["id"]||o.jsId,bar_id:t.shapecode,end_image:r,remarks:o.remarks,sound:n,is_xi:i["is_xi"],is_xiu:i["is_xiu"]}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){200==t.data.code&&setTimeout(function(){e.redirectTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):o.upImgs(this.shoeboxImgArr,o.qiniuToken).then(function(r){var s;r=c(new Set((s=r).concat.apply(s,c(t.shoeboxImgResArr)))),console.log(r),(0,a.default)("/api/auth/setDone","POST",{wash_id:JSON.parse(e.getStorageSync("user"))["id"]||o.jsId,bar_id:o.shapecode,end_image:r,remarks:o.remarks,sound:n,is_xi:i["is_xi"],is_xiu:i["is_xiu"]}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){setTimeout(function(){e.redirectTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}})};t.default=v}).call(this,o("543d")["default"])},4592:function(e,t,o){},"66a0":function(e,t,o){"use strict";(function(e){o("e6f8"),o("921b");n(o("66fd"));var t=n(o("f682"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},a1cd:function(e,t,o){"use strict";var n=o("4592"),i=o.n(n);i.a},cd73:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=(e._self._c,e.__map(e.shoeboxImgArr,function(t,o){var n=e.Exhibition(t);return{$orig:e.__get_orig(t),m0:n}}));e.$mp.data=Object.assign({},{$root:{l0:o}})},i=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return i})},f682:function(e,t,o){"use strict";o.r(t);var n=o("cd73"),i=o("fa11");for(var a in i)"default"!==a&&function(e){o.d(t,e,function(){return i[e]})}(a);o("a1cd");var r=o("2877"),s=Object(r["a"])(i["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},fa11:function(e,t,o){"use strict";o.r(t);var n=o("0953"),i=o.n(n);for(var a in n)"default"!==a&&function(e){o.d(t,e,function(){return n[e]})}(a);t["default"]=i.a}},[["66a0","common/runtime","common/vendor"]]]);