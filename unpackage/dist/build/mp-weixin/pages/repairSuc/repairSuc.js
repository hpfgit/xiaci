(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/repairSuc/repairSuc"],{"0953":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=o("2f62"),a=r(o("45aa")),i=r(o("da85"));function r(e){return e&&e.__esModule?e:{default:e}}function s(e){return d(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},n=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),n.forEach(function(t){f(e,t,o[t])})}return e}function f(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var h=e.getRecorderManager(),p=e.createInnerAudioContext(),m="",g=getApp(),v={data:function(){return{id:"",imgArr:[],shoeboxImgArr:[],shoeboxImgResArr:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[]}},onLoad:function(){var e=this;(0,i.default)("/api/auth/getQiniuToken","POST",{}).then(function(t){e.qiniuToken=t.data}),(0,i.default)("/api/auth/getOrder","POST",{bar_id:this.shapecode}).then(function(t){t.data.length&&(e.shoeboxImgArr=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.shoeboxImgResArr=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.sound=t.data[0].sound,e.upShapeCode(t.data[0].bar_id),e.upJSName(t.data[0].username),console.log(t))})},computed:l({},(0,n.mapState)(["jsName","shapecode","jsId"])),methods:l({},(0,n.mapMutations)(["upShapeCode","upJSName"]),{isPlayImg:function(e){var t=e?"gif":"png",o="../../static/images/play_bg.",n=o+t;return n},add_shoeboxImg:function(){var t=this,o=this.shoeboxImgArr;console.log(o),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.shoeboxImgArr=o.concat(e.tempFilePaths)}})},add_img:function(){var t=this,o=t.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.imgArr=o.concat(e.tempFilePaths)}})},deteleImg:function(e){var t=e.currentTarget.dataset.index,o=this.imgArr;o.splice(t,1),this.imgArr=o},add_remarks:function(e){var t=e.detail.value;this.remarks=t},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};h.start(e),h.onStart(function(){console.log("recorder start")}),h.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;h.stop(),h.onStop(function(t){console.log(t),e.time=Math.round(t.duration/1e3),e.is_recode=!1,e.voice=t.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",t.tempFilePath)})},playRecode:function(){var e=this,t=this,o=this.time;p.src=t.voice,p.play();var n=0;this.isplay=!0,m=setInterval(function(){if(n++,console.log(o),n>o)clearInterval(m),p.stop(),t.isplay=!1;else{var a=parseInt(n/60)+":"+parseInt(60*(parseFloat(n/60)-parseInt(n/60)));e.result_time=a}},1e3)},stop_play:function(){clearInterval(m),p.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,t){var o=this,n=[],i=[];return e.forEach(function(e){/static\.tosneaker\.com/gi.test(e)||i.push(e)}),0===i.length?Promise.resolve(e):new Promise(function(e,r){i.forEach(function(s){var c=s.substr(30,50);a.default.upload(s,function(t){n.push(t.imageURL),o.resultImgArr=n,n.length==i.length&&e(n)},function(e){r(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:g.globalData.qiniuImgUrl,key:"uploads/wash/"+c,uptoken:t})})})},upRecord:function(e,t){return new Promise(function(o,n){var i=e.substr(30,50);a.default.upload(e,function(e){o(e)},function(e){n(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:g.globalData.qiniuImgUrl,key:"uploads/record/"+i,uptoken:t})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){var t=this;if(e.showLoading({mask:!0,title:"加载中..."}),0==this.shoeboxImgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张修复完成图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});var o=this,n="";""!==o.voice?o.upRecord(o.voice,o.qiniuToken).then(function(a){n=a.imageURL,console.log(n),o.upImgs(t.shoeboxImgArr,o.qiniuToken).then(function(a){var r;a=s(new Set((r=a).concat.apply(r,s(t.shoeboxImgResArr)))),console.log(a),(0,i.default)("/api/auth/setDone","POST",{wash_id:o.jsId,bar_id:t.shapecode,end_image:a,remarks:o.remarks,sound:n}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){200==t.data.code&&setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):o.upImgs(this.shoeboxImgArr,o.qiniuToken).then(function(a){var r;a=s(new Set((r=a).concat.apply(r,s(t.shoeboxImgResArr)))),console.log(a),(0,i.default)("/api/auth/setDone","POST",{wash_id:o.jsId,bar_id:o.shapecode,end_image:a,remarks:o.remarks,sound:n}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}})};t.default=v}).call(this,o("543d")["default"])},4592:function(e,t,o){},"66a0":function(e,t,o){"use strict";(function(e){o("e6f8"),o("921b");n(o("66fd"));var t=n(o("f682"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},a1cd:function(e,t,o){"use strict";var n=o("4592"),a=o.n(n);a.a},efaa:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"a",function(){return n}),o.d(t,"b",function(){return a})},f682:function(e,t,o){"use strict";o.r(t);var n=o("efaa"),a=o("fa11");for(var i in a)"default"!==i&&function(e){o.d(t,e,function(){return a[e]})}(i);o("a1cd");var r=o("2877"),s=Object(r["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=s.exports},fa11:function(e,t,o){"use strict";o.r(t);var n=o("0953"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,function(){return n[e]})}(i);t["default"]=a.a}},[["66a0","common/runtime","common/vendor"]]]);