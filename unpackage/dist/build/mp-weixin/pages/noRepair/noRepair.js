(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/noRepair/noRepair"],{"35bb":function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement,t=(e._self._c,e.isPlayImg(e.isplay));e.$mp.data=Object.assign({},{$root:{m0:t}})},i=[];t.d(o,"a",function(){return n}),t.d(o,"b",function(){return i})},"53d9":function(e,o,t){"use strict";(function(e){t("e6f8"),t("921b");n(t("66fd"));var o=n(t("6c8a"));function n(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,t("543d")["createPage"])},"6a91":function(e,o,t){"use strict";t.r(o);var n=t("e37f"),i=t.n(n);for(var r in n)"default"!==r&&function(e){t.d(o,e,function(){return n[e]})}(r);o["default"]=i.a},"6c8a":function(e,o,t){"use strict";t.r(o);var n=t("35bb"),i=t("6a91");for(var r in i)"default"!==r&&function(e){t.d(o,e,function(){return i[e]})}(r);t("a370");var a=t("2877"),s=Object(a["a"])(i["default"],n["a"],n["b"],!1,null,null,null);o["default"]=s.exports},a370:function(e,o,t){"use strict";var n=t("b19d"),i=t.n(n);i.a},b19d:function(e,o,t){},e37f:function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=t("2f62"),i=a(t("45aa")),r=a(t("da85"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{},n=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(o){c(e,o,t[o])})}return e}function c(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}var u=e.getRecorderManager(),l=e.createInnerAudioContext(),d="",f=getApp(),h={data:function(){return{id:"",imgArr:[],shoeboxImgArr:[],repairImgArr:[],shoeboxImgResArr:[],repairImgResArr:[],resultImgArr:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[]}},onLoad:function(){var e=this;(0,r.default)("/api/auth/getQiniuToken","POST",{}).then(function(o){console.log(o),e.qiniuToken=o.data})},computed:s({},(0,n.mapState)(["jsName","shapecode","jsId"])),methods:{isPlayImg:function(e){var o=e?"gif":"png",t="../../static/images/play_bg.",n=t+o;return n},add_shoeboxImg:function(){var o=this,t=this.shoeboxImgArr;console.log(t),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e,o),o.shoeboxImgArr=t.concat(e.tempFilePaths)}})},add_img:function(){var o=this,t=o.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){o.imgArr=t.concat(e.tempFilePaths)}})},deteleImg:function(e){var o=e.currentTarget.dataset.index,t=this.imgArr;t.splice(o,1),this.imgArr=t},add_remarks:function(e){var o=e.detail.value;this.remarks=o},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){console.log(11);var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};u.start(e),u.onStart(function(){console.log("recorder start")}),u.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;console.log(22);u.stop(),u.onStop(function(o){console.log(o),e.time=Math.round(o.duration/1e3),e.is_recode=!1,e.voice=o.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",o.tempFilePath)})},playRecode:function(){var e=this,o=this,t=this.time;l.src=o.voice,l.play();var n=0;this.isplay=!0,d=setInterval(function(){if(n++,console.log(t),n>t)clearInterval(d),l.stop(),o.isplay=!1;else{var i=parseInt(n/60)+":"+parseInt(60*(parseFloat(n/60)-parseInt(n/60)));e.result_time=i}},1e3)},stop_play:function(){clearInterval(d),l.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,o){var t=this,n=[];return new Promise(function(r,a){e.forEach(function(s){var c=s.substr(30,50);i.default.upload(s,function(o){n.push(o.imageURL),t.resultImgArr,n.length==e.length&&r(n)},function(e){a(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:f.globalData.qiniuImgUrl,key:"uploads/wash/"+c,uptoken:o})})})},upRecord:function(e,o){return new Promise(function(t,n){var r=e.substr(30,50);i.default.upload(e,function(e){t(e)},function(e){n(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:f.globalData.qiniuImgUrl,key:"uploads/record/"+r,uptoken:o})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){e.showLoading({mask:!0,title:"加载中..."});var o="";if(0==this.shoeboxImgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张不可修复图片",icon:"none"});if(""==this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});var t=this;""!=t.voice?t.upRecord(t.voice,t.qiniuToken).then(function(n){o=n.imageURL,t.upImgs(t.shoeboxImgArr,t.qiniuToken).then(function(n){console.log(n),(0,r.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,unrepair_image:n,remarks:t.remarks,sound:o}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){200==o.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):t.upImgs(t.shoeboxImgArr,t.qiniuToken).then(function(n){console.log(n),(0,r.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,unrepair_image:n,remarks:t.remarks,sound:o}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}}};o.default=h}).call(this,t("543d")["default"])}},[["53d9","common/runtime","common/vendor"]]]);