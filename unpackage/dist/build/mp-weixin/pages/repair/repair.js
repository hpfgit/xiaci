(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/repair/repair"],{"0b98":function(e,o,i){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t=i("2f62"),n=a(i("c618")),s=a(i("f2b5"));function a(e){return e&&e.__esModule?e:{default:e}}function r(e){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{},t=Object.keys(i);"function"===typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),t.forEach(function(o){c(e,o,i[o])})}return e}function c(e,o,i){return o in e?Object.defineProperty(e,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[o]=i,e}var u=e.getRecorderManager(),l=e.createInnerAudioContext(),d="",h=getApp(),g={data:function(){return{id:"",imgArr:[],shoeboxImgArr:[],repairImgArr:[],shoeboxImgResArr:[],repairImgResArr:[],resultImgArr:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[],items:[{value:"is_xi",name:"清洗",checked:!0},{value:"is_xiu",name:"修复"}]}},onLoad:function(){var e=this;(0,s.default)("/api/auth/getQiniuToken","POST",{}).then(function(o){console.log(o),e.qiniuToken=o.data})},computed:r({},(0,t.mapState)(["jsName","shapecode","jsId"])),methods:{checkboxChange:function(e){for(var o=this.items,i=e.detail.value,t=0,n=o.length;t<n;++t){var s=o[t];i.includes(s.value)?this.$set(s,"checked",!0):this.$set(s,"checked",!1)}},isPlayImg:function(e){var o=e?"gif":"png",i="../../static/images/play_bg.",t=i+o;return t},add_shoeboxImg:function(){var o=this,i=this.shoeboxImgArr;console.log(i),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e,o),o.shoeboxImgArr=i.concat(e.tempFilePaths)}})},add_img:function(){var o=this,i=o.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){o.imgArr=i.concat(e.tempFilePaths)}})},deteleImg:function(e){var o=e.currentTarget.dataset.index,i=this.imgArr;i.splice(o,1),this.imgArr=i},add_remarks:function(e){var o=e.detail.value;this.remarks=o},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){console.log(11);var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};u.start(e),u.onStart(function(){console.log("recorder start")}),u.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;console.log(22);u.stop(),u.onStop(function(o){console.log(o),e.time=Math.round(o.duration/1e3),e.is_recode=!1,e.voice=o.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",o.tempFilePath)})},playRecode:function(){var e=this,o=this,i=this.time;l.src=o.voice,l.play();var t=0;this.isplay=!0,d=setInterval(function(){if(t++,console.log(i),t>i)clearInterval(d),l.stop(),o.isplay=!1;else{var n=parseInt(t/60)+":"+parseInt(60*(parseFloat(t/60)-parseInt(t/60)));e.result_time=n}},1e3)},stop_play:function(){clearInterval(d),l.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,o){var i=this,t=[];return new Promise(function(s,a){e.forEach(function(r){var c=r.substr(30,50);n.default.upload(r,function(o){t.push(o.imageURL),i.resultImgArr,t.length==e.length&&s(t)},function(e){a(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:h.globalData.qiniuImgUrl,key:"uploads/wash/"+c,uptoken:o})})})},upRecord:function(e,o){return new Promise(function(i,t){var s=e.substr(30,50);n.default.upload(e,function(e){i(e)},function(e){t(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:h.globalData.qiniuImgUrl,key:"uploads/record/"+s,uptoken:o})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){var o=this;e.showLoading({mask:!0,title:"加载中..."});var i="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var t=this,n={},a=0;a<this.items.length;a++)this.items[a].checked&&(n[[this.items[a].value]]=1);""!=t.voice?t.upRecord(t.voice,t.qiniuToken).then(function(a){i=a.imageURL,t.upImgs(t.imgArr,t.qiniuToken).then(function(a){console.log(a),t.upImgs(o.shoeboxImgArr,t.qiniuToken).then(function(r){console.log(r),(0,s.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,original_image:a,shoes_image:r,remarks:t.remarks,sound:i,sound_length:o.time,is_xi:n["is_xi"],is_xiu:n["is_xiu"]}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){200==o.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):t.upImgs(t.imgArr,t.qiniuToken).then(function(a){console.log(a),t.upImgs(o.shoeboxImgArr,t.qiniuToken).then(function(o){console.log(o),(0,s.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,original_image:a,shoes_image:o,remarks:t.remarks,sound:i,is_xi:n["is_xi"],is_xiu:n["is_xiu"]}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})},no_submit:function(){var o=this;e.showLoading({mask:!0,title:"加载中..."});var i="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var t=this,n={},a=0;a<this.items.length;a++)this.items[a].checked&&(n[[this.items[a].value]]=1);""!=t.voice?t.upRecord(t.voice,t.qiniuToken).then(function(a){i=a.imageURL,t.upImgs(t.imgArr,t.qiniuToken).then(function(a){console.log(a),t.upImgs(o.shoeboxImgArr,t.qiniuToken).then(function(r){console.log(r);var c=r;(0,s.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,original_image:a,shoes_image:r,remarks:t.remarks,unrepair_image:c,sound:i,sound_length:o.time,is_xi:n["is_xi"],is_xiu:n["is_xiu"],states:5}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){200==o.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):t.upImgs(t.imgArr,t.qiniuToken).then(function(a){console.log(a),t.upImgs(o.shoeboxImgArr,t.qiniuToken).then(function(o){console.log(o);var r=o;(0,s.default)("/api/auth/order","POST",{consignor_id:t.jsId,bar_id:t.shapecode,original_image:a,unrepair_image:r,shoes_image:o,remarks:t.remarks,sound:i,is_xi:n["is_xi"],is_xiu:n["is_xiu"],states:5}).then(function(o){e.hideLoading(),e.showToast({title:o.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(o){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}}};o.default=g}).call(this,i("543d")["default"])},"3dfa":function(e,o,i){"use strict";i.r(o);var t=i("0b98"),n=i.n(t);for(var s in t)"default"!==s&&function(e){i.d(o,e,function(){return t[e]})}(s);o["default"]=n.a},"5b07":function(e,o,i){"use strict";(function(e){i("c424"),i("921b");t(i("66fd"));var o=t(i("8c77"));function t(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,i("543d")["createPage"])},"7dcc":function(e,o,i){},"8c77":function(e,o,i){"use strict";i.r(o);var t=i("afb8"),n=i("3dfa");for(var s in n)"default"!==s&&function(e){i.d(o,e,function(){return n[e]})}(s);i("cd09");var a=i("2877"),r=Object(a["a"])(n["default"],t["a"],t["b"],!1,null,null,null);o["default"]=r.exports},afb8:function(e,o,i){"use strict";var t=function(){var e=this,o=e.$createElement,i=(e._self._c,e.isPlayImg(e.isplay));e.$mp.data=Object.assign({},{$root:{m0:i}})},n=[];i.d(o,"a",function(){return t}),i.d(o,"b",function(){return n})},cd09:function(e,o,i){"use strict";var t=i("7dcc"),n=i.n(t);n.a}},[["5b07","common/runtime","common/vendor"]]]);