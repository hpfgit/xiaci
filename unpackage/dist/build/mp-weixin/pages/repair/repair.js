(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/repair/repair"],{"141b":function(e,i,t){"use strict";(function(e){t("e6f8"),t("921b");n(t("66fd"));var i=n(t("a2b4"));function n(e){return e&&e.__esModule?e:{default:e}}e(i.default)}).call(this,t("543d")["createPage"])},"2d4f":function(e,i,t){"use strict";t.r(i);var n=t("461a"),o=t.n(n);for(var a in n)"default"!==a&&function(e){t.d(i,e,function(){return n[e]})}(a);i["default"]=o.a},"461a":function(e,i,t){"use strict";(function(e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=t("2f62"),o=s(t("45aa")),a=s(t("da85"));function s(e){return e&&e.__esModule?e:{default:e}}function r(e){return l(e)||u(e)||c()}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function u(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function l(e){if(Array.isArray(e)){for(var i=0,t=new Array(e.length);i<e.length;i++)t[i]=e[i];return t}}function d(e){for(var i=1;i<arguments.length;i++){var t=null!=arguments[i]?arguments[i]:{},n=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.forEach(function(i){h(e,i,t[i])})}return e}function h(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}var g=e.getRecorderManager(),m=e.createInnerAudioContext(),p="",f=getApp(),_={data:function(){return{id:"",imgArr:[],imgArrRes:[],shoeboxImgArr:[],repairImgArr:[],shoeboxImgResArr:[],repairImgResArr:[],resultImgArr:[],unrepair_image:[],unrepair_imageRes:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[],items:[{value:"is_xi",name:"清洗",checked:!0},{value:"is_xiu",name:"修复"}],resData:[]}},onLoad:function(){var e=this;(0,a.default)("/api/auth/getQiniuToken","POST",{}).then(function(i){console.log(i),e.qiniuToken=i.data}),(0,a.default)("/api/auth/getOrder","POST",{bar_id:this.shapecode}).then(function(i){console.log(i),i.data.length&&(e.resData=i.data,e.shoeboxImgArr=null===i.data[0].shoes_image?[]:JSON.parse(i.data[0].shoes_image),e.shoeboxImgResArr=null===i.data[0].shoes_image?[]:JSON.parse(i.data[0].shoes_image),e.imgArr=null===i.data[0].original_image?[]:JSON.parse(i.data[0].original_image),e.imgArrRes=null===i.data[0].original_image?[]:JSON.parse(i.data[0].original_image),e.unrepair_image=null===i.data[0].end_image?[]:JSON.parse(i.data[0].end_image),e.unrepair_imageRes=null===i.data[0].end_image?[]:JSON.parse(i.data[0].end_image),e.sound=i.data[0].sound,e.upShapeCode(i.data[0].bar_id),e.upJSName(i.data[0].username))})},computed:d({},(0,n.mapState)(["jsName","shapecode","jsId"])),methods:d({},(0,n.mapMutations)(["upJSName","upShapeCode"]),{checkboxChange:function(e){for(var i=this.items,t=e.detail.value,n=0,o=i.length;n<o;++n){var a=i[n];t.includes(a.value)?this.$set(a,"checked",!0):this.$set(a,"checked",!1)}},isPlayImg:function(e){var i=e?"gif":"png",t="../../static/images/play_bg.",n=t+i;return n},add_shoeboxImg:function(){var i=this,t=this.shoeboxImgArr;console.log(t),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e,i),i.shoeboxImgArr=t.concat(e.tempFilePaths)}})},add_img:function(){var i=this,t=i.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){i.imgArr=t.concat(e.tempFilePaths)}})},add_unrepair_img:function(){var i=this,t=i.unrepair_image;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){i.unrepair_image=t.concat(e.tempFilePaths)}})},deteleImg:function(e){var i=e.currentTarget.dataset.index;this.shoeboxImgArr.splice(i,1),i<=this.shoeboxImgResArr.length-1&&this.shoeboxImgResArr.splice(i,1)},deteleImg2:function(e){var i=e.currentTarget.dataset.index;this.imgArr.splice(i,1),i<=this.imgArrRes.length-1&&this.imgArrRes.splice(i,1)},deteleImg3:function(e){var i=e.currentTarget.dataset.index;this.unrepair_image.splice(i,1),i<=this.unrepair_imageRes.length-1&&this.unrepair_imageRes.splice(i,1),console.log(this.unrepair_imageRes)},add_remarks:function(e){var i=e.detail.value;this.remarks=i},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){console.log(11);var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};g.start(e),g.onStart(function(){console.log("recorder start")}),g.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;console.log(22);g.stop(),g.onStop(function(i){console.log(i),e.time=Math.round(i.duration/1e3),e.is_recode=!1,e.voice=i.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",i.tempFilePath)})},playRecode:function(){var e=this,i=this,t=this.time;m.src=i.voice,m.play();var n=0;this.isplay=!0,p=setInterval(function(){if(n++,console.log(t),n>t)clearInterval(p),m.stop(),i.isplay=!1;else{var o=parseInt(n/60)+":"+parseInt(60*(parseFloat(n/60)-parseInt(n/60)));e.result_time=o}},1e3)},stop_play:function(){clearInterval(p),m.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,i){var t=[],n=[];return e.forEach(function(e){/static\.tosneaker\.com/gi.test(e)&&/uploads/gi.test(e)||n.push(e)}),console.log(e),0===n.length?Promise.resolve(e):new Promise(function(e,a){n.forEach(function(s){var r=s.substr(30,50);o.default.upload(s,function(i){t.push(i.imageURL),t.length==n.length&&e(t)},function(e){a(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:f.globalData.qiniuImgUrl,key:"uploads/wash/"+r,uptoken:i})})})},upRecord:function(e,i){return new Promise(function(t,n){var a=e.substr(30,50);o.default.upload(e,function(e){t(e)},function(e){n(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:f.globalData.qiniuImgUrl,key:"uploads/record/"+a,uptoken:i})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){var i=this;e.showLoading({mask:!0,title:"加载中..."});var t="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var n=this,o={},s=0;s<this.items.length;s++)this.items[s].checked&&(o[[this.items[s].value]]=1);""!=n.voice?n.upRecord(n.voice,n.qiniuToken).then(function(s){t=s.imageURL,n.upImgs(n.imgArr,n.qiniuToken).then(function(s){var c;s=r(new Set((c=s).concat.apply(c,r(i.imgArrRes)))),console.log(n.shoeboxImgArr),n.upImgs(n.shoeboxImgArr,n.qiniuToken).then(function(c){var u;console.log(c),c=r(new Set((u=c).concat.apply(u,r(i.shoeboxImgResArr)))),n.upImgs(i.unrepair_image,n.qiniuToken).then(function(u){var l;console.log(u),u=r(new Set((l=u).concat.apply(l,r(i.unrepair_imageRes)))),(0,a.default)("/api/auth/order","POST",{consignor_id:n.jsId,bar_id:n.shapecode,original_image:s,shoes_image:c,remarks:n.remarks,end_image:u,sound:t,sound_length:i.time,is_xi:o["is_xi"],is_xiu:o["is_xiu"]}).then(function(i){e.hideLoading(),e.showToast({title:i.data.message,icon:"none",duration:1e3,complete:function(){200==i.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):n.upImgs(n.imgArr,n.qiniuToken).then(function(s){var c;s=r(new Set((c=s).concat.apply(c,r(i.imgArrRes)))),n.upImgs(i.shoeboxImgArr,n.qiniuToken).then(function(c){var u;c=r(new Set((u=c).concat.apply(u,r(i.shoeboxImgResArr)))),n.upImgs(i.unrepair_image,n.qiniuToken).then(function(u){var l;u=r(new Set((l=u).concat.apply(l,r(i.unrepair_imageRes))));var d="/api/auth/order";i.resData.length&&(d="/api/auth/updateOrder"),console.log(c),(0,a.default)(d,"POST",{consignor_id:n.jsId,bar_id:n.shapecode,original_image:s,shoes_image:c,remarks:n.remarks,end_image:u,sound:t,is_xi:o["is_xi"],is_xiu:o["is_xiu"]}).then(function(i){e.hideLoading(),e.showToast({title:i.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})},no_submit:function(){var i=this;e.showLoading({mask:!0,title:"加载中..."});var t="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var n=this,o={},s=0;s<this.items.length;s++)this.items[s].checked&&(o[[this.items[s].value]]=1);""!=n.voice?n.upRecord(n.voice,n.qiniuToken).then(function(s){t=s.imageURL,n.upImgs(n.imgArr,n.qiniuToken).then(function(s){console.log(s),n.upImgs(i.shoeboxImgArr,n.qiniuToken).then(function(r){console.log(r);var c=r;(0,a.default)("/api/auth/order","POST",{consignor_id:n.jsId,bar_id:n.shapecode,original_image:s,shoes_image:r,remarks:n.remarks,unrepair_image:c,sound:t,sound_length:i.time,is_xi:o["is_xi"],is_xiu:o["is_xiu"],states:5}).then(function(i){e.hideLoading(),e.showToast({title:i.data.message,icon:"none",duration:1e3,complete:function(){200==i.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):n.upImgs(n.imgArr,n.qiniuToken).then(function(s){console.log(s),n.upImgs(i.shoeboxImgArr,n.qiniuToken).then(function(i){console.log(i);var r=i;(0,a.default)("/api/auth/order","POST",{consignor_id:n.jsId,bar_id:n.shapecode,original_image:s,unrepair_image:r,shoes_image:i,remarks:n.remarks,sound:t,is_xi:o["is_xi"],is_xiu:o["is_xiu"],states:5}).then(function(i){e.hideLoading(),e.showToast({title:i.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(i){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}})};i.default=_}).call(this,t("543d")["default"])},"5d70":function(e,i,t){},a2b4:function(e,i,t){"use strict";t.r(i);var n=t("c73b"),o=t("2d4f");for(var a in o)"default"!==a&&function(e){t.d(i,e,function(){return o[e]})}(a);t("f6b3");var s=t("2877"),r=Object(s["a"])(o["default"],n["a"],n["b"],!1,null,null,null);i["default"]=r.exports},c73b:function(e,i,t){"use strict";var n=function(){var e=this,i=e.$createElement,t=(e._self._c,e.isPlayImg(e.isplay));e.$mp.data=Object.assign({},{$root:{m0:t}})},o=[];t.d(i,"a",function(){return n}),t.d(i,"b",function(){return o})},f6b3:function(e,i,t){"use strict";var n=t("5d70"),o=t.n(n);o.a}},[["141b","common/runtime","common/vendor"]]]);