(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/repair/repair"],{"141b":function(e,t,n){"use strict";(function(e){n("e6f8"),n("921b");o(n("66fd"));var t=o(n("a2b4"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},"25bc":function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.shoeboxImgArr,function(t,n){var o=e.Exhibition(t);return{$orig:e.__get_orig(t),m0:o}})),o=e.__map(e.imgArr,function(t,n){var o=e.Exhibition(t);return{$orig:e.__get_orig(t),m1:o}}),i=e.__map(e.unrepair_image,function(t,n){var o=e.Exhibition(t);return{$orig:e.__get_orig(t),m2:o}}),a=e.isPlayImg(e.isplay);e.$mp.data=Object.assign({},{$root:{l0:n,l1:o,l2:i,m3:a}})},i=[];n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i})},"2d4f":function(e,t,n){"use strict";n.r(t);var o=n("461a"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,function(){return o[e]})}(a);t["default"]=i.a},"461a":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("2f62"),i=s(n("45aa")),a=s(n("da85")),r=s(n("fbf6"));function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return d(e)||l(e)||u()}function u(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function l(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){h(e,t,n[t])})}return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=e.getRecorderManager(),p=e.createInnerAudioContext(),f="",_=getApp(),v={data:function(){return{id:"",imgArr:[],imgArrRes:[],shoeboxImgArr:[],repairImgArr:[],shoeboxImgResArr:[],repairImgResArr:[],resultImgArr:[],unrepair_image:[],unrepair_imageRes:[],qiniuToken:"",is_value:"",voice:"",is_recode:!1,recode_load:!1,is_recode_end:!1,time:0,result_time:"--:--",isplay:!1,remarks:"",checked:[],totalPrice:0,scheme:[],items:[{value:"is_xi",name:"清洗",checked:!1},{value:"is_xiu",name:"修复",checked:!1}],resData:[]}},onLoad:function(){var e=this;console.log(this.shapecode),(0,a.default)("/api/auth/getQiniuToken","POST",{}).then(function(t){console.log(t),e.qiniuToken=t.data}),(0,a.default)("/api/auth/getOrder","POST",{bar_id:this.shapecode}).then(function(t){console.log(t),t.data.length&&(e.resData=t.data,e.shoeboxImgArr=null===t.data[0].shoes_image?[]:JSON.parse(t.data[0].shoes_image),e.shoeboxImgResArr=null===t.data[0].shoes_image?[]:JSON.parse(t.data[0].shoes_image),e.imgArr=null===t.data[0].original_image?[]:JSON.parse(t.data[0].original_image),e.imgArrRes=null===t.data[0].original_image?[]:JSON.parse(t.data[0].original_image),e.unrepair_image=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.unrepair_imageRes=null===t.data[0].end_image?[]:JSON.parse(t.data[0].end_image),e.sound=t.data[0].sound,e.upShapeCode(t.data[0].bar_id),e.upJSName(t.data[0].username))})},computed:g({},(0,o.mapState)(["jsName","shapecode","jsId"])),methods:g({},(0,o.mapMutations)(["upJSName","upShapeCode"]),{checkboxChange:function(e){for(var t=this.items,n=e.detail.value,o=0,i=t.length;o<i;++o){var a=t[o];n.includes(a.value)?this.$set(a,"checked",!0):this.$set(a,"checked",!1)}},Exhibition:function(e){return/static\.tosneaker\.com/gi.test(e)||/tmp/gi.test(e)?e:r.default.qiniuImgUrl+e},isPlayImg:function(e){var t=e?"gif":"png",n="../../static/images/play_bg.",o=n+t;return o},add_shoeboxImg:function(){var t=this,n=this.shoeboxImgArr;console.log(n),e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log(e,t),t.shoeboxImgArr=n.concat(e.tempFilePaths)}})},add_img:function(){var t=this,n=t.imgArr;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.imgArr=n.concat(e.tempFilePaths)}})},add_unrepair_img:function(){var t=this,n=t.unrepair_image;e.chooseImage({sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){t.unrepair_image=n.concat(e.tempFilePaths)}})},deteleImg:function(e){var t=e.currentTarget.dataset.index;this.shoeboxImgArr.splice(t,1),t<=this.shoeboxImgResArr.length-1&&this.shoeboxImgResArr.splice(t,1)},deteleImg2:function(e){var t=e.currentTarget.dataset.index;this.imgArr.splice(t,1),t<=this.imgArrRes.length-1&&this.imgArrRes.splice(t,1)},deteleImg3:function(e){var t=e.currentTarget.dataset.index;this.unrepair_image.splice(t,1),t<=this.unrepair_imageRes.length-1&&this.unrepair_imageRes.splice(t,1),console.log(this.unrepair_imageRes)},add_remarks:function(e){var t=e.detail.value;this.remarks=t},isRecode:function(e){e?this.stopRecode():this.startRecode()},startRecode:function(){console.log(11);var e={duration:1e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};m.start(e),m.onStart(function(){console.log("recorder start")}),m.onError(function(e){console.log(e)}),this.recode_load=!0,this.is_recode=!0},stopRecode:function(){var e=this;console.log(22);m.stop(),m.onStop(function(t){console.log(t),e.time=Math.round(t.duration/1e3),e.is_recode=!1,e.voice=t.tempFilePath,e.is_recode_end=!0,e.recode_load=!1,console.log("停止录音",t.tempFilePath)})},playRecode:function(){var e=this,t=this,n=this.time;p.src=t.voice,p.play();var o=0;this.isplay=!0,f=setInterval(function(){if(o++,console.log(n),o>n)clearInterval(f),p.stop(),t.isplay=!1;else{var i=parseInt(o/60)+":"+parseInt(60*(parseFloat(o/60)-parseInt(o/60)));e.result_time=i}},1e3)},stop_play:function(){clearInterval(f),p.stop(),this.isplay=!1},remove_record:function(){console.log(11),this.voice="",this.is_recode=!1,this.recode_load=!1,this.is_recode_end=!1,this.time=0,this.result_time="--:--",this.isplay=!1},upImgs:function(e,t){var n=[],o=[];return e.forEach(function(e){/static\.tosneaker\.com/gi.test(e)||/uploads/gi.test(e)||o.push(e)}),console.log(e,o),0===o.length?Promise.resolve(e):new Promise(function(e,a){o.forEach(function(r){var s=r.substr(30,50);i.default.upload(r,function(t){n.push(t.imageURL),n.length==o.length&&e(n)},function(e){a(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:_.globalData.qiniuImgUrl,key:"uploads/wash/"+s,uptoken:t})})})},upRecord:function(e,t){return new Promise(function(n,o){var a=e.substr(30,50);i.default.upload(e,function(e){n(e)},function(e){o(e)},{region:"NCN",uploadURL:"https://upload-z1.qiniup.com",domain:_.globalData.qiniuImgUrl,key:"uploads/record/"+a,uptoken:t})})},is_return:function(){e.redirectTo({url:"../check/check"})},is_submit:function(){var t=this;e.showLoading({mask:!0,title:"加载中..."});var n="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var o=this,i={},r=0;r<this.items.length;r++)this.items[r].checked&&(i[[this.items[r].value]]=1);""!=o.voice?o.upRecord(o.voice,o.qiniuToken).then(function(r){n=r.imageURL,o.upImgs(o.imgArr,o.qiniuToken).then(function(r){var s;r=c(new Set((s=r).concat.apply(s,c(t.imgArrRes)))),console.log(o.shoeboxImgArr),o.upImgs(o.shoeboxImgArr,o.qiniuToken).then(function(s){var u;console.log(s),s=c(new Set((u=s).concat.apply(u,c(t.shoeboxImgResArr)))),o.upImgs(t.unrepair_image,o.qiniuToken).then(function(u){var l;console.log(u),u=c(new Set((l=u).concat.apply(l,c(t.unrepair_imageRes)))),(0,a.default)("/api/auth/order","POST",{consignor_id:o.jsId,bar_id:o.shapecode,original_image:r,shoes_image:s,remarks:o.remarks,end_image:u,sound:n,sound_length:t.time,is_xi:i["is_xi"],is_xiu:i["is_xiu"]}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){200==t.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.redirectTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):o.upImgs(o.imgArr,o.qiniuToken).then(function(i){var r;i=c(new Set((r=i).concat.apply(r,c(t.imgArrRes)))),o.upImgs(t.shoeboxImgArr,o.qiniuToken).then(function(r){var s;r=c(new Set((s=r).concat.apply(s,c(t.shoeboxImgResArr)))),o.upImgs(t.unrepair_image,o.qiniuToken).then(function(s){var u;s=c(new Set((u=s).concat.apply(u,c(t.unrepair_imageRes))));var l="/api/auth/order";t.resData.length&&(l="/api/auth/updateOrder"),console.log(r),(0,a.default)(l,"POST",{consignor_id:o.jsId,bar_id:o.shapecode,original_image:i,shoes_image:r,remarks:o.remarks,end_image:s,sound:n}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.redirectTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){console.log(t),e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})},no_submit:function(){var t=this;e.showLoading({mask:!0,title:"加载中..."});var n="";if(0==this.imgArr.length)return e.hideLoading(),void e.showToast({title:"至少添加一张瑕疵图片",icon:"none"});if(""===this.shapecode)return e.hideLoading(),void e.showToast({title:"条形码为必填项",icon:"none"});for(var o=this,i={},r=0;r<this.items.length;r++)this.items[r].checked&&(i[[this.items[r].value]]=1);""!=o.voice?o.upRecord(o.voice,o.qiniuToken).then(function(i){n=i.imageURL,o.upImgs(o.imgArr,o.qiniuToken).then(function(i){console.log(i),o.upImgs(t.shoeboxImgArr,o.qiniuToken).then(function(r){console.log(r);var s=r;(0,a.default)("/api/auth/order","POST",{consignor_id:o.jsId,bar_id:o.shapecode,original_image:i,shoes_image:r,remarks:o.remarks,unrepair_image:s,sound:n,sound_length:t.time,states:5}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){200==t.data.status&&(e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3))}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"录音上传失败",icon:"none"})}):o.upImgs(o.imgArr,o.qiniuToken).then(function(i){console.log(i),o.upImgs(t.shoeboxImgArr,o.qiniuToken).then(function(t){console.log(t);var r=t;(0,a.default)("/api/auth/order","POST",{consignor_id:o.jsId,bar_id:o.shapecode,original_image:i,unrepair_image:r,shoes_image:t,remarks:o.remarks,sound:n,states:5}).then(function(t){e.hideLoading(),e.showToast({title:t.data.message,icon:"none",duration:1e3,complete:function(){e.showToast({title:"添加完成",icon:"none"}),setTimeout(function(){e.navigateTo({url:"../sweep/sweep"})},1e3)}})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}).catch(function(t){e.hideLoading(),e.showToast({title:"图片上传失败",icon:"none"})})}})};t.default=v}).call(this,n("543d")["default"])},"5d70":function(e,t,n){},a2b4:function(e,t,n){"use strict";n.r(t);var o=n("25bc"),i=n("2d4f");for(var a in i)"default"!==a&&function(e){n.d(t,e,function(){return i[e]})}(a);n("f6b3");var r=n("2877"),s=Object(r["a"])(i["default"],o["a"],o["b"],!1,null,null,null);t["default"]=s.exports},f6b3:function(e,t,n){"use strict";var o=n("5d70"),i=n.n(o);i.a}},[["141b","common/runtime","common/vendor"]]]);